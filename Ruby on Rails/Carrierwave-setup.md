Quick start with CarrierWave Image Uploads.

First generate a scaffold or if you have an existing app that's fine. But In my case I need to generate a new one with bare the minimum.

In this scaffold we are going to make a simple app that will take a username and image for an avatar. So now we can translate it into this scaffold. 

We'll name it as username:string for now.

##### 1. Generate a Scaffold

```
rails g scaffold User username:string
```

Second, We need to Install the gem "carrierwave" and place it into our gemfile. just go to rubygems.org and search for the latest version of carrierwave. then do a bundle install.

##### 2. Configure CW

Now, to configure CW, Run the built in generator to create the uploader class that inherits from CW's internal helpers.

```
rails g uploader image
```

This will create a folder called uploader in the `app/` directory.

##### 3. Mount the image uploader to our model.

Now, we need to generate a migration file to add the image into our model, There are two steps here so let's begin.

Here, The first step is we need to make a migration to add the image_uploader to our schema.

```
rails g migration AddImagetoUser image:string
rake db:migrate
```

Then, On our model we can simply mount the mount_uploader and pass in the column name and the uploader class.

```ruby
class User < ApplicationRecord
  validates_presence_of :title
  mount_uploader :image, ImageUploader
end
```

##### 5. Whitelist it inside of our strong params in the controller

`app/controllers/users_controller.rb`

```ruby
def user_params
  params.require(:user).permite(:username, :image)
end
```

##### 6. Setting up the View

The code below enables the file upload to happen inside the form. since we are using form_for, We don't need to explicitly add the ":html => {:multipart => true}" to the form. 

`app/views/_form.html.erb`

```
<%= form_for @user do |f| %>
  
  <div class="field">
    <%= f.label :username %>
    <%= f.text_field :username %>
  </div>
  
  <!-- Add file_field-->
  <div class="field">
    add an image....
    <%= f.file_field :image %>
  </div>
<% end %>
```

Now, To actually show the image.

go to `app/views/show_html.erb`

```
<p>
  <strong>Title:</strong>
  <%= @user.title %>
  <%= image_tag @user.image_url.to_s%>
</p>

<%= link_to 'Edit', edit_snippet_path(@snippet) %> |
<%= link_to 'Back', snippets_path %>
```

This will show the uploaded image, Be sure to convert it into a string so as the image_tag can know that it is processing an image.

##### 7. Making sure a user only uploads images.

go to `app/uploaders/image_uploader.rb` Then add a whitelist for file extensions. Note the %w separates the jpg jpeg and so on with commas. The %w is a "word array" - the elements are delimited by spaces.

```ruby
def extension_white_list
  %w(jpg jpeg gif png)
end
```



##### 8. Setting up Thumbnails 

Go to `app/uploaders/image_uploader.rb` Then from inside un comment this line. 

``` ruby
version :thumb do
  process :resize_to_fit => [50, 50]
end
```

> "A ‘version’ uses a ‘process’. The processes and the provided instance methods like the :resize_to_fit are from another gem: either RMagick and MiniMagick. I went with MiniMagick, for no other reasons than that this one seems to be more friendly on memory usage. Either way, you need to include one of them, by uncommenting the proper line:"  — [Maud de Vries](https://medium.com/@mauddev)



Next we need to uncomment one line from between the two.

Since we're going to use MiniMagick to handle the process.

we'll user MiniMagick.

```ruby
class ImageUploader < CarrierWave::Uploader::Base
  # Include RMagick or MiniMagick support:
  # include CarrierWave::RMagick
  include CarrierWave::MiniMagick
```

Also Make sure that you have imagemagick install a simple brew install imagemagick will do the trick.



Next we need to add `MiniMagick` gem to our gemfile

```
# File uploader

gem 'carrierwave'
gem 'mini_magick' # For different versions of an image
```

Run bundle install, and then restart the server.



To show the thumbnail in the view. We simply just add this line of code through the .each/loop that is generated by our scaffold.

```erb
<% @snippets.each do |snippet| %>
  <tr>
    <td><%= image_tag snippet.image_url(:thumb).to_s %></td>
    <td><%= snippet.title %></td>
    <td><%= link_to 'Show', snippet %></td>
    <td><%= link_to 'Edit', edit_snippet_path(snippet) %></td>
    <td><%= link_to 'Destroy', snippet, method: :delete, data: { confirm: 'Are you sure?' } %></td>
  </tr>
<% end %>
```

You need to reupload the image again if you wish to see the thumbnail appearing in the view. 



Uploading CarrierWave Images to S3